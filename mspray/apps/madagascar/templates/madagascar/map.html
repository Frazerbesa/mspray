{% extends 'madagascar/base.html' %}

{% load staticfiles %}

{% block map-nav %}
                <div class="collapse navbar-collapse" id="msp-collapse">
                    <ul class="nav navbar-nav navbar-right">
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle"
                               data-toggle="dropdown">
                                <span class="dist_label">Districts : {{ object.district_name }}</span>
                                <b class="caret"></b>
                            </a>
                            <ul class="dropdown-menu" id="districts_list">
                            {% for district_name in districts %}
                                <li>
                                    <a href="{% url 'madagascar:district' district_name  %}">{{ district_name }}</a>
                                </li>
                            {% endfor %}
                            </ul>
                        </li>
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle"
                               data-toggle="dropdown">
                                <span class="target_label">Target Area: {{ object.targetid }}</span>
                                <b class="caret"></b>
                            </a>
                            <ul class="dropdown-menu">
                                <li>
                                    <form action="/" method="post" class="form-inline" id="search_form">
                                        <input type="text" name="target_filter" class="target_filter form-control" placeholder="Search..."/>
                                    </form>
                                    <ul id="target_areas_list">
                                    {% for targetid in target_areas %}
                                        <li>
                                            <a href="{% url 'madagascar:target_area' object.district_name targetid  %}">{{ targetid }}</a>
                                        </li>
                                    {% endfor %}
                                    </ul>
                                </li>
                            </ul>
                        </li>
                        <li class="dropdown" id="spray_date_picker">
                            <a href="#" class="dropdown-toggle"
                               data-toggle="dropdown">
                                <span class="sprayday_label">Date: {{ spray_date }}</span>
                                <b class="caret"></b>
                            </a>
                            <ul class="dropdown-menu" id="spraydays_list">
                            {% for day in target_data.spray_dates %}
                                <li>
                                    <a href="{% url 'madagascar:target_area' object.district_name object.targetid  %}?spray_date={{ day|date:'Y-m-d' }}">{{ day }}</a>
                                </li>
                            {% endfor %}
                            </ul>
                        </li>
                        <li class="active" id="target-area-stats-item"><a>Target Area Stats</a></li>
                    </ul>
                </div>
{% endblock %}

{% block content %}

        <section class="info-panel">
            <div class="info-holder">
                <h4><span class="dist_label" id="target-area-label"> </span></h4>

                <div>
                    <dl class="dl-horizontal" id="target-area-stats-structures">
                    </dl>
                </div>
                <hr>
                <div>
                    <dl class="dl-horizontal" id="target-area-stats">
                    </dl>
                </div>
                <hr>
                <div id="not-sprayed-reasons">
                    <p>Not Sprayed</p>
                    <dl class="dl-horizontal" id="target-area-stats-not-sprayed">
                    </dl>
                </div>
            </div>
        </section>

        <div id="map"></div>

    <div id="map-legend">
        <h2><span class="day_label">All</span></h2>
        <div class="legend big clearfix">
            <div class="circle-holder">
                <div id="circle-sprayed"> </div>
                <p id="sprayed-label">Sprayed</p>
                <p id="sprayed-ratio"></p>
            </div>
        </div>

        <div class="legend small clearfix">
            <div class="circle-holder">
                <div id="circle-refused"> </div>
                <p class="small-legend-label">Refused</p>
            </div>

            <div class="circle-holder">
                <div id="circle-other"> </div>
                <p class="small-legend-label">Other</p>
            </div>
        </div>
    </div>

{% endblock %}

{% block scripts %}
    {{ block.super }}
    <script src="{% static "js/jquery-1.11.3.min.js" %}"></script>
    <script src="{% static "js/bootstrap.min.js" %}"></script>
    <script src='https://api.tiles.mapbox.com/mapbox.js/v2.2.0/mapbox.js'></script>
    <script src="http://maps.google.com/maps/api/js?v=3&sensor=false"></script>
    <script src="{% static "js/Google.js" %}"></script>
    <script src="{% static "js/Bing.js" %}"></script>
    <script src="{% static "js/circles.min.js" %}"></script>
    <script src="{% static "js/app.js" %}"></script>

    <script type="text/javascript">
        var bounds = {{ target_data.bounds|safe }};
        var app = new App();
        app.fitBounds(bounds);

        app.housesCount = {{ target_data.structures }};
        app.visitedTotal = {{ target_data.visited_total }};

        var buffers_url = "{{ request.get_host }}{% url 'householdsbuffer-list' %}?target_area={{ object.targetid }}";
        app.loadBufferAreas(buffers_url, undefined, true);
        var spraypoints_url = "{{ request.get_host }}{% url 'sprayday-list' %}?target_area={{ object.targetid }}&spray_date={{ spray_date|date:'Y-m-d' }}";
        app.loadSprayPoints(spraypoints_url);
    </script>
{% endblock %}
