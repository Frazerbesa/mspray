# IRS Dashboard

Data is collected at [ona.io](https://ona.io) with an IRS Household Form. This form includes information on whether a structure is sprayable, whether it was sprayed, and who the spray operator is. A web hook is created for the IRS Household Form to push each form submission to the dashboard `/api/spraydays` API endpoint. This is the primary way data gets into the IRS dashboard.

## Data Ingestion

The Ona web hook posts a single form submission data in JSON format to `/api/spraydays`, which will be processed by the [add_spray_data(data)](https://github.com/onaio/mspray/blob/docs/mspray/apps/main/utils.py#L253) function. This data will be stored in the [spray_day](https://github.com/onaio/mspray/blob/docs/mspray/apps/main/models/spray_day.py#L48) table, there is a 1-1 match of records with existing data in the Ona platform IRS Household Form. If the record was marked as sprayed, the `was_sprayed` field is set to `True`. If the record was marked as NOT sprayable the `sprayable` field is set to `False`, also the related structure [household](https://github.com/onaio/mspray/blob/docs/mspray/apps/main/models/household.py#L9) object has the `sprayable` field set to `False`. The record is linked to a spray area location object, first by GPS, if that fails then by OSMID, if that fails then by the geometric information contained in the OSM file, if that fails the fallback is on the `spray_area` field in the data. A specific structure/household may have duplicate IRS Household records refering to it.

We then create a unique record for each structure that has been reported on an IRS Household Form per spray area on the [spray_point](https://github.com/onaio/mspray/blob/docs/mspray/apps/main/models/spraypoint.py#L8) table. This would result in the unique record set for all structures reported in specific spray/target area. The `data_id` is usually the OSMID of a structure, in the event we received a GPS point and no OSMID then the gps point will be used as the `data_id`.

## IRS: CSV All Spray Areas

| District	| Health Centre	| Spray Area	| Structures on Ground	| Found	| Visited Sprayed	| Spray Effectiveness	| Found Coverage	| Sprayed Coverage |
|-----------|---------------|---------------|-----------------------|-------|-------------------|-----------------------|-------------------|------------------|
| Chadiza	| Bwanunkha	| BNK_10	| 81	| 81	| 76	| 94	| 100	| 94 |

This is generated by the [SprayAreaView](https://github.com/onaio/mspray/blob/docs/mspray/apps/main/views/home.py#L268). We utilize the [TargetAreaSerializer](https://github.com/onaio/mspray/blob/docs/mspray/apps/main/views/home.py#L354) to generate the numbers from the spray area queryset, and the full definition of the serializer is in the [target_area.py](https://github.com/onaio/mspray/blob/docs/mspray/apps/main/serializers/target_area.py#L1055) module.

Each spray area location has `structures` linked to it, a structure is a household object. We import households from OSM XML files for each spray area provided when setting up the dashboard. We store households in the [household](https://github.com/onaio/mspray/blob/docs/mspray/apps/main/models/household.py#L9) table and we store spray areas in the [location](https://github.com/onaio/mspray/blob/docs/mspray/apps/main/models/location.py#L33) table with the location level as `ta` for a spray/target area.

- **Enumerated Structures** - All structures from the initial OSM files of enumerated structures.
- **Sprayable Structures** - Enumerated structures we subtract the number of reported structures that were reported as `not sprayable` that are in the `spray_point` table. [target_area.py#L194](https://github.com/onaio/mspray/blob/docs/mspray/apps/main/serializers/target_area.py#L194).
- **New Structures** - Is the sum of all structures that were identified as new, the structures are usually new nodes and in most cases we only get a GPS point and no OSMID. [target_area.py#L206](https://github.com/onaio/mspray/blob/docs/mspray/apps/main/serializers/target_area.py#L206).
- **Sprayed duplicate** - Is the number of duplicate sprayable structure records where the structures were sprayed. If structure A had 3 records and all the 3 records were reported as sprayed, the sprayed duplicate will be 3 - 1 = 2. [target_area.py#L285](https://github.com/onaio/mspray/blob/docs/mspray/apps/main/serializers/target_area.py#L285).
- **Structures on Ground** = `new structures` + `sprayable structures` + `sprayed duplicate`; [target_area.py#L715](https://github.com/onaio/mspray/blob/docs/mspray/apps/main/serializers/target_area.py#L715).
- **Found** - All sprayable structures that have been visited (all records in the `spray_point` table that are sprayable + `sprayed duplicate` records). [target_area.py#L156](https://github.com/onaio/mspray/blob/docs/mspray/apps/main/serializers/target_area.py#L156).
- **Visited Sprayed** = all records in the `spray_point` table that are sprayable and were sprayed + `sprayed duplicate` records. [target_area.py#L169](https://github.com/onaio/mspray/blob/docs/mspray/apps/main/serializers/target_area.py#L169).
- **Spray Effectiveness** = percentage of `visited sprayed` structures of  `structures on the ground`. [home.py#L389](https://github.com/onaio/mspray/blob/docs/mspray/apps/main/views/home.py#L389).
- **Found Coverage** = percentage of `found` structures of `structures on the ground`. [home.py#L392](https://github.com/onaio/mspray/blob/docs/mspray/apps/main/views/home.py#L392).
- **Sprayed Coverage** = percentage of `visited sprayed` structures of `found` structures. [home.py#L394](https://github.com/onaio/mspray/blob/docs/mspray/apps/main/views/home.py#L394).

